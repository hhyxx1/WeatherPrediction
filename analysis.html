<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±åº¦å¤©æ°”åˆ†æ - æ™ºèƒ½å¤©æ°”é¢„æŠ¥</title>
    <script src="weatherApiConfig.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- è°·æ­Œå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* è‡ªå®šä¹‰CSSå˜é‡ */
        :root {
            --primary-color: #0ea5e9;
            --secondary-color: #3b82f6;
            --primary-light: #7dd3fc;
            --card-background: rgba(255, 255, 255, 0.7);
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        /* å…¨å±€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            min-height: 100vh;
            color: #1e293b;
            overflow-x: hidden;
        }
        
        /* ç»ç’ƒæ€æ•ˆæœ */
        .glass-effect {
            background: var(--card-background);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
        }
        
        .glass-effect:hover {
            box-shadow: var(--shadow-medium);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        /* æµ®åŠ¨ç²’å­èƒŒæ™¯ */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: floatUp linear infinite;
        }
        
        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.4;
            }
            90% {
                opacity: 0.4;
            }
            100% {
                transform: translateY(-20vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* åˆ†æå¡ç‰‡æ ·å¼ */
        .analysis-card {
            background: var(--card-background);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        
        .analysis-card:hover::before {
            transform: scaleX(1);
        }
        
        /* åˆ†æç»“æœæ ·å¼ */
        .analysis-result {
            line-height: 1.8;
            color: #475569;
        }
        
        .analysis-result p {
            margin-bottom: 1rem;
        }
        
        .analysis-result h4 {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* åŸå¸‚é€‰æ‹©å™¨æ ·å¼ */
        .city-selector {
            transition: all 0.3s ease;
        }
        
        .city-selector:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        /* åˆ†ææŒ‰é’®æ ·å¼ */
        .analyze-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.4);
        }
        
        .analyze-button:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }
        
        /* æ•°æ®åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(14, 165, 233, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* å›¾è¡¨å®¹å™¨æ ·å¼ */
        .chart-container {
            height: 400px;
            width: 100%;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .analysis-card {
                border-radius: 12px;
            }
        }
        
        /* å¯¼èˆªé“¾æ¥æ ·å¼ */
        nav a {
            position: relative;
            transition: all 0.3s ease;
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-light);
            transition: width 0.3s ease;
        }
        
        nav a:hover::after, nav a.text-blue-600::after {
            width: 100%;
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <!-- æµ®åŠ¨ç²’å­èƒŒæ™¯ -->
    <div class="floating-particles">
        <div class="particle w-2 h-2" style="left: 10%; animation-delay: 0s; animation-duration: 20s;"></div>
        <div class="particle w-3 h-3" style="left: 20%; animation-delay: 1s; animation-duration: 25s;"></div>
        <div class="particle w-1 h-1" style="left: 30%; animation-delay: 2s; animation-duration: 15s;"></div>
        <div class="particle w-2 h-2" style="left: 40%; animation-delay: 3s; animation-duration: 22s;"></div>
        <div class="particle w-3 h-3" style="left: 50%; animation-delay: 4s; animation-duration: 18s;"></div>
        <div class="particle w-1 h-1" style="left: 60%; animation-delay: 5s; animation-duration: 24s;"></div>
        <div class="particle w-2 h-2" style="left: 70%; animation-delay: 0.5s; animation-duration: 16s;"></div>
        <div class="particle w-3 h-3" style="left: 80%; animation-delay: 1.5s; animation-duration: 21s;"></div>
        <div class="particle w-1 h-1" style="left: 90%; animation-delay: 2.5s; animation-duration: 19s;"></div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="glass-effect fixed top-0 left-0 right-0 z-50 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="weather-icon">ğŸŒ¤ï¸</div>
                <h1 class="text-lg md:text-2xl font-bold text-slate-800" style="font-family: 'Noto Serif SC', serif;">
                    å…¨çƒå¤©æ°”æ•°æ®åˆ†æç³»ç»Ÿ
                </h1>
            </div>
            
            <div class="hidden md:flex items-center space-x-8">
                <a href="index.html" class="text-slate-700 hover:text-blue-600 font-medium transition-colors">
                    å®æ—¶ç›‘æ§
                </a>
                <a href="analysis.html" class="text-blue-600 font-medium">
                    æ·±åº¦åˆ†æ
                </a>
                <a href="about.html" class="text-slate-700 hover:text-blue-600 font-medium transition-colors">
                    å…³äºç³»ç»Ÿ
                </a>
            </div>
            
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <div class="md:hidden">
                <button onclick="toggleMobileMenu()" class="text-slate-700 hover:text-blue-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 border-t border-slate-200">
            <div class="flex flex-col space-y-3 pt-4">
                <a href="index.html" class="text-slate-700 hover:text-blue-600 font-medium transition-colors px-2">
                    å®æ—¶ç›‘æ§
                </a>
                <a href="analysis.html" class="text-blue-600 font-medium px-2">
                    æ·±åº¦åˆ†æ
                </a>
                <a href="about.html" class="text-slate-700 hover:text-blue-600 font-medium transition-colors px-2">
                    å…³äºç³»ç»Ÿ
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="pt-20 px-4 pb-12">
        <div class="max-w-7xl mx-auto">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="text-center mb-10">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4" style="font-family: 'Noto Serif SC', serif;">
                    å¤©æ°”æ·±åº¦åˆ†æ
                </h2>
                <p class="text-slate-600 max-w-2xl mx-auto">
                    åŸºäºAIæŠ€æœ¯çš„å¤©æ°”æ•°æ®æ·±åº¦åˆ†æï¼Œä¸ºæ‚¨æä¾›æ›´ç²¾å‡†çš„å¤©æ°”è¶‹åŠ¿æ´å¯Ÿå’Œé¢„æµ‹å»ºè®®
                </p>
            </div>

            <!-- åŸå¸‚æœç´¢ç»„ä»¶ - ç§»åˆ°bodyç›´æ¥å­å…ƒç´ ä½ç½®ä»¥é¿å…å±‚çº§é—®é¢˜ -->
            <div class="relative z-1000 mb-6">
                <label for="citySearch" class="block text-sm font-medium text-slate-700 mb-1">
                    æœç´¢åŸå¸‚
                </label>
                <div class="relative" style="position: relative; z-index: 9999;">
                    <input 
                        type="text" 
                        id="citySearch" 
                        placeholder="è¾“å…¥åŸå¸‚åç§°..."
                        class="city-selector bg-white/80 backdrop-blur-sm border border-slate-300 rounded-lg px-4 py-2 w-full text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        oninput="handleCitySearch()"
                    >
                    <div id="citySearchResults" class="hidden fixed z-9999 left-0 right-0 mx-auto w-full max-w-md mt-1 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                        <!-- æœç´¢ç»“æœä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                </div>
                <div id="selectedCityInfo" class="mt-2 text-sm text-slate-600 hidden">
                    å·²é€‰æ‹©: <span id="selectedCityName">åŒ—äº¬</span>
                    <button id="changeCityBtn" class="ml-2 text-blue-600 hover:text-blue-800">æ›´æ¢</button>
                </div>
                <input type="hidden" id="selectedCityId" value="101010100">
            </div>
            
            <!-- åˆ†ææ§åˆ¶ -->
            <div class="glass-effect rounded-2xl p-6 mb-8">
                <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                    <div class="flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-6">

                        <!-- æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">
                                åˆ†ææ—¶é—´èŒƒå›´ (å¤©)
                            </label>
                            <div class="flex items-center space-x-2">
                                <input 
                                    type="range" 
                                    id="timeRangeSlider" 
                                    min="1" 
                                    max="10" 
                                    value="7"
                                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                >
                                <span id="timeRangeValue" class="text-sm font-medium text-slate-700 min-w-[30px]">7</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">æ‹–åŠ¨æ»‘å—é€‰æ‹©1-10å¤©çš„åˆ†æèŒƒå›´</p>
                        </div>

                        <!-- AIé¢„æµ‹å¤©æ•°é€‰æ‹©å™¨ -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">
                                AIé¢„æµ‹å¤©æ•° (å¤©)
                            </label>
                            <div class="flex items-center space-x-2">
                                <input 
                                    type="range" 
                                    id="predictionDaysSlider" 
                                    min="1" 
                                    max="14" 
                                    value="3"
                                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                                >
                                <span id="predictionDaysValue" class="text-sm font-medium text-slate-700 min-w-[30px]">3</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">æ‹–åŠ¨æ»‘å—é€‰æ‹©1-14å¤©çš„AIé¢„æµ‹èŒƒå›´</p>
                        </div>
                    </div>

                    <!-- åˆ†ææŒ‰é’® -->
                    <button id="analyzeButton" class="analyze-button" onclick="analyzeWeatherData()">
                        <i class="fa fa-bar-chart mr-2"></i>å¼€å§‹åˆ†æ
                    </button>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingState" class="hidden flex flex-col items-center justify-center py-20">
                <div class="loading-spinner mb-4"></div>
                <p class="text-slate-700">æ­£åœ¨è·å–å¤©æ°”æ•°æ®å¹¶è¿›è¡Œæ·±åº¦åˆ†æ...</p>
            </div>

            <!-- åˆ†æç»“æœåŒºåŸŸ -->
            <div id="analysisResults" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- åˆ†ææ¦‚è¿°å¡ç‰‡ -->
                <div class="lg:col-span-1 analysis-card p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">
                        <i class="fa fa-lightbulb-o text-yellow-500 mr-2"></i>åˆ†ææ¦‚è¿°
                    </h3>
                    <div id="analysisSummary" class="analysis-result">
                        <p class="text-slate-500 italic">è¯·é€‰æ‹©åŸå¸‚å¹¶ç‚¹å‡»å¼€å§‹åˆ†ææŒ‰é’®æŸ¥çœ‹ç»“æœ</p>
                    </div>
                </div>

                <!-- è¯¦ç»†åˆ†æå¡ç‰‡ -->
                <div class="lg:col-span-2 analysis-card p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">
                        <i class="fa fa-area-chart text-blue-500 mr-2"></i>è¯¦ç»†åˆ†æ
                    </h3>
                    <div id="detailedAnalysis" class="analysis-result">
                        <p class="text-slate-500 italic">åˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
                    </div>
                </div>
            </div>

            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- æ¸©åº¦è¶‹åŠ¿å›¾è¡¨ -->
                <div class="analysis-card p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">
                        <i class="fa fa-thermometer-half text-red-500 mr-2"></i>æ¸©åº¦è¶‹åŠ¿åˆ†æ
                    </h3>
                    <div id="temperatureChart" class="chart-container"></div>
                </div>

                <!-- é™æ°´æ¦‚ç‡å›¾è¡¨ -->
                <div class="analysis-card p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">
                        <i class="fa fa-tint text-blue-500 mr-2"></i>é™æ°´æ¦‚ç‡åˆ†æ
                    </h3>
                    <div id="precipitationChart" class="chart-container"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }

        // å…¨å±€é…ç½®å¯¹è±¡ï¼Œä½¿ç”¨weatherApiConfig.jsä¸­çš„é…ç½®
        const config = {
            weatherApi: {
                baseUrl: window.WEATHER_CONFIG?.weatherApi?.baseUrl || 'https://devapi.qweather.com/v7',
                key: window.WEATHER_CONFIG?.weatherApi?.key || 'YOUR_API_KEY',
                geoApiUrl: window.WEATHER_CONFIG?.weatherApi?.geoBaseUrl || 'https://geoapi.qweather.com/v2'
            },
            deepseekApi: {
                baseUrl: window.WEATHER_CONFIG?.aiApi?.baseUrl || 'https://api.deepseek.com/v1',
                apiKey: window.WEATHER_CONFIG?.aiApi?.key || 'YOUR_API_KEY'
            },
            currentCity: {
                id: '101020100',
                name: 'ä¸Šæµ·'
            }
        };

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // ä»URLå‚æ•°æˆ–localStorageè·å–åŸå¸‚ä¿¡æ¯
            const urlParams = new URLSearchParams(window.location.search);
            const cityId = urlParams.get('cityId');
            const cityName = urlParams.get('cityName');
            
            if (cityId && cityName) {
                // ä»URLå‚æ•°è·å–ï¼ˆä»é¦–é¡µè·³è½¬è¿‡æ¥ï¼‰
                config.currentCity = { id: cityId, name: cityName };
                setSelectedCity(cityId, cityName);
            } else {
                // æ£€æŸ¥localStorageæ˜¯å¦æœ‰ä¿å­˜çš„åŸå¸‚
                const savedCity = localStorage.getItem('selectedCity');
                if (savedCity) {
                    const parsedCity = JSON.parse(savedCity);
                    config.currentCity = parsedCity;
                    setSelectedCity(parsedCity.id, parsedCity.name);
                } else {
                    // é»˜è®¤åŸå¸‚ä¸ºä¸Šæµ·
                    config.currentCity = { id: '101020100', name: 'ä¸Šæµ·' };
                    setSelectedCity('101020100', 'ä¸Šæµ·');
                }
            }

            // åˆå§‹åŒ–æ—¶é—´èŒƒå›´æ»‘å—
            const slider = document.getElementById('timeRangeSlider');
            const valueDisplay = document.getElementById('timeRangeValue');
            slider.addEventListener('input', function() {
                valueDisplay.textContent = this.value;
            });

            // åˆå§‹åŒ–AIé¢„æµ‹å¤©æ•°æ»‘å—
            const predictionSlider = document.getElementById('predictionDaysSlider');
            const predictionValueDisplay = document.getElementById('predictionDaysValue');
            predictionSlider.addEventListener('input', function() {
                predictionValueDisplay.textContent = this.value;
            });

            // åˆå§‹åŒ–æ›´æ¢åŸå¸‚æŒ‰é’®
            document.getElementById('changeCityBtn').addEventListener('click', function() {
                document.getElementById('citySearch').classList.remove('hidden');
                document.getElementById('selectedCityInfo').classList.add('hidden');
                document.getElementById('citySearch').focus();
            });

            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
        }

        // è®¾ç½®é€‰ä¸­çš„åŸå¸‚
        function setSelectedCity(cityId, cityName) {
            document.getElementById('selectedCityId').value = cityId;
            document.getElementById('selectedCityName').textContent = cityName;
            document.getElementById('selectedCityInfo').classList.remove('hidden');
            document.getElementById('citySearch').classList.add('hidden');
            document.getElementById('citySearchResults').classList.add('hidden');
        }

        // å¤„ç†åŸå¸‚æœç´¢
        async function handleCitySearch() {
            const searchTerm = document.getElementById('citySearch').value.trim();
            const resultsContainer = document.getElementById('citySearchResults');
            
            if (searchTerm.length < 2) {
                resultsContainer.classList.add('hidden');
                return;
            }

            try {
                // ä½¿ç”¨å’Œé£å¤©æ°”çš„åœ°ç†ç¼–ç APIæœç´¢åŸå¸‚
                const url = `${config.weatherApi.geoApiUrl}/city/lookup?location=${encodeURIComponent(searchTerm)}&key=${config.weatherApi.key}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.code === '200' && data.location && data.location.length > 0) {
                    // æ˜¾ç¤ºæœç´¢ç»“æœ
                    resultsContainer.innerHTML = '';
                    data.location.slice(0, 10).forEach(city => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'px-4 py-2 hover:bg-blue-50 cursor-pointer transition-colors';
                        resultItem.innerHTML = `
                            <div class="font-medium">${city.name}</div>
                            <div class="text-xs text-slate-500">${city.adminArea || ''}${city.country || ''}</div>
                        `;
                        resultItem.addEventListener('click', () => {
                            config.currentCity = { id: city.id, name: city.name };
                            localStorage.setItem('selectedCity', JSON.stringify(config.currentCity));
                            setSelectedCity(city.id, city.name);
                        });
                        resultsContainer.appendChild(resultItem);
                    });
                    resultsContainer.classList.remove('hidden');
                } else {
                    resultsContainer.classList.add('hidden');
                }
            } catch (error) {
                console.error('åŸå¸‚æœç´¢å¤±è´¥:', error);
                resultsContainer.classList.add('hidden');
            }
        }

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æœç´¢ç»“æœ
        document.addEventListener('click', function(event) {
            const searchContainer = document.querySelector('#citySearch').parentElement;
            const resultsContainer = document.getElementById('citySearchResults');
            
            if (!searchContainer.contains(event.target)) {
                resultsContainer.classList.add('hidden');
            }
        });

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // æ¸©åº¦è¶‹åŠ¿å›¾è¡¨
            const temperatureChart = echarts.init(document.getElementById('temperatureChart'));
            temperatureChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                    borderColor: '#ddd',
                    textStyle: { color: '#333' }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: [],
                    axisLine: { lineStyle: { color: '#ddd' } },
                    axisLabel: { color: '#666' }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ¸©åº¦ (Â°C)',
                    nameTextStyle: { color: '#666' },
                    axisLine: { lineStyle: { color: '#ddd' } },
                    axisLabel: { color: '#666' },
                    splitLine: { lineStyle: { color: '#f0f0f0' } }
                },
                series: [{
                    name: 'æ¸©åº¦',
                    type: 'line',
                    data: [],
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    itemStyle: { color: '#ff7e67' },
                    areaStyle: { color: 'rgba(255, 126, 103, 0.1)' },
                    lineStyle: { width: 3 }
                }]
            });

            // é™æ°´æ¦‚ç‡å›¾è¡¨
            const precipitationChart = echarts.init(document.getElementById('precipitationChart'));
            precipitationChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                    borderColor: '#ddd',
                    textStyle: { color: '#333' }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: [],
                    axisLine: { lineStyle: { color: '#ddd' } },
                    axisLabel: { color: '#666' }
                },
                yAxis: {
                    type: 'value',
                    name: 'é™æ°´æ¦‚ç‡ (%)',
                    nameTextStyle: { color: '#666' },
                    axisLine: { lineStyle: { color: '#ddd' } },
                    axisLabel: { color: '#666' },
                    splitLine: { lineStyle: { color: '#f0f0f0' } },
                    max: 100
                },
                series: [{
                    name: 'é™æ°´æ¦‚ç‡',
                    type: 'line',
                    data: [],
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    itemStyle: { color: '#7dd3fc' },
                    areaStyle: { color: 'rgba(125, 211, 252, 0.1)' },
                    lineStyle: { width: 3 }
                }]
            });

            // å“åº”å¼è°ƒæ•´
            window.addEventListener('resize', () => {
                temperatureChart.resize();
                precipitationChart.resize();
            });
        }

        // åˆ†æå¤©æ°”æ•°æ®
        async function analyzeWeatherData() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('analysisResults').classList.add('hidden');
            
            // è·å–é€‰æ‹©çš„åŸå¸‚ã€æ—¶é—´èŒƒå›´å’ŒAIé¢„æµ‹å¤©æ•°
            const cityId = document.getElementById('selectedCityId').value;
            const cityName = document.getElementById('selectedCityName').textContent;
            const days = parseInt(document.getElementById('timeRangeSlider').value);
            const predictionDays = parseInt(document.getElementById('predictionDaysSlider').value);
            const timeRange = `${days}d`;
            
            config.currentCity = { id: cityId, name: cityName };
            localStorage.setItem('selectedCity', JSON.stringify(config.currentCity));
            
            try {
                // è·å–å¤©æ°”æ•°æ®
                const weatherData = await fetchWeatherData(cityId, timeRange);
                
                // ä½¿ç”¨DeepSeek APIè·å–é¢„æµ‹æ•°æ®
                const predictionData = await getAIPredictionData(weatherData, cityName, predictionDays);
                
                // ä½¿ç”¨DeepSeek APIè¿›è¡Œæ·±åº¦åˆ†æ
                const analysisResult = await analyzeWithDeepSeek(weatherData, cityName, timeRange);
                
                // æ›´æ–°å›¾è¡¨ï¼ŒåŒ…æ‹¬é¢„æµ‹æ•°æ®
                updateCharts(weatherData, predictionData);
                
                // æ˜¾ç¤ºåˆ†æç»“æœ
                displayAnalysisResults(analysisResult);
            } catch (error) {
                console.error('åˆ†æå¤±è´¥:', error);
                document.getElementById('analysisSummary').innerHTML = `<p class="text-red-500">åˆ†æå¤±è´¥: ${error.message}</p>`;
                document.getElementById('detailedAnalysis').innerHTML = `<p class="text-red-500">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•</p>`;
            } finally {
                // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºç»“æœ
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('analysisResults').classList.remove('hidden');
            }
        }

        // ä»å’Œé£å¤©æ°”APIè·å–å†å²å¤©æ°”æ•°æ®
        async function fetchWeatherData(cityId, timeRange) {
            // æå–å¤©æ•°
            let days = parseInt(timeRange.replace('d', ''));
            
            // æ ¹æ®APIé™åˆ¶ï¼Œæœ€å¤šåªèƒ½è·å–æœ€è¿‘10å¤©çš„å†å²æ•°æ®ï¼ˆä¸åŒ…å«ä»Šå¤©ï¼‰
            const MAX_DAYS = 10;
            if (days > MAX_DAYS) {
                console.log(`è¯·æ±‚${days}å¤©æ•°æ®ï¼Œä½†å¤©æ°”æ—¶å…‰æœºAPIæœ€å¤§åªèƒ½æä¾›${MAX_DAYS}å¤©å†å²æ•°æ®`);
                days = MAX_DAYS;
            }
            
            // è®¡ç®—éœ€è¦è·å–çš„æ—¥æœŸèŒƒå›´
            const dates = [];
            const today = new Date();
            
            // ä»æ˜¨å¤©å¼€å§‹ï¼Œå¾€å‰æ¨dayså¤©
            for (let i = 1; i <= days; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                // æ ¼å¼åŒ–ä¸ºyyyyMMdd
                const formattedDate = formatDate(date);
                dates.push(formattedDate);
            }
            
            // ä¸ºæ¯ä¸€å¤©å•ç‹¬è¯·æ±‚æ•°æ®
            const historicalData = [];
            
            for (const date of dates) {
                const url = `${config.weatherApi.baseUrl}/historical/weather?location=${cityId}&date=${date}&key=${config.weatherApi.key}`;
                console.log(`è·å–å†å²å¤©æ°”æ•°æ®ï¼Œæ—¥æœŸ: ${date}ï¼ŒURL: ${url}`);
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`è·å–${date}çš„å†å²å¤©æ°”æ•°æ®å¤±è´¥`);
                }
                
                const data = await response.json();
                
                if (data.code !== '200' || !data.weatherDaily) {
                    throw new Error(`${date}çš„å†å²å¤©æ°”æ•°æ®æ ¼å¼é”™è¯¯`);
                }
                
                // è½¬æ¢æ•°æ®æ ¼å¼ä»¥åŒ¹é…åŸæœ‰çš„æ•°æ®ç»“æ„
                const dailyData = {
                    fxDate: data.weatherDaily.date,  // æ—¥æœŸ
                    tempMax: data.weatherDaily.tempMax,  // æœ€é«˜æ¸©åº¦
                    tempMin: data.weatherDaily.tempMin,  // æœ€ä½æ¸©åº¦
                    precip: data.weatherDaily.precip,  // é™æ°´é‡
                    humidity: data.weatherDaily.humidity,  // æ¹¿åº¦
                    pressure: data.weatherDaily.pressure  // æ°”å‹
                };
                
                historicalData.push(dailyData);
            }
            
            // è¿”å›æŒ‰æ—¥æœŸæ­£åºæ’åˆ—çš„å†å²æ•°æ®
            return historicalData.reverse();
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸä¸ºyyyyMMdd
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // ä½¿ç”¨DeepSeek APIè·å–AIé¢„æµ‹æ•°æ®
        async function getAIPredictionData(historicalData, cityName, predictionDays) {
            // å‡†å¤‡å‘é€ç»™DeepSeekçš„æç¤ºä¿¡æ¯ï¼Œè¦æ±‚é¢„æµ‹æœªæ¥å‡ å¤©çš„å¤©æ°”
            const prompt = `ä»¥ä¸‹æ˜¯å¯¹${cityName}æœ€è¿‘${Object.keys(historicalData).length}å¤©å†å²å¤©æ°”æ•°æ®çš„æ·±åº¦åˆ†æç»“æœã€‚è¯·åŸºäºè¿™äº›å†å²æ•°æ®ï¼Œé¢„æµ‹æœªæ¥${predictionDays}å¤©çš„å¤©æ°”æƒ…å†µã€‚
            è¯·æ³¨æ„ï¼šæä¾›çš„æ•°æ®æ˜¯å†å²æ•°æ®ï¼Œä¸æ˜¯æœªæ¥æ•°æ®ã€‚é¢„æµ‹åº”åŸºäºå†å²æ•°æ®çš„æ¨¡å¼å’Œè¶‹åŠ¿è¿›è¡Œã€‚
            è¯·è¿”å›ç»“æ„åŒ–çš„JSONæ•°æ®ï¼ŒåªåŒ…å«é¢„æµ‹ç»“æœï¼Œä¸è¦å…¶ä»–æ–‡å­—è¯´æ˜ã€‚
            æ¯ä¸ªé¢„æµ‹ç»“æœéœ€è¦åŒ…å«ï¼šæ—¥æœŸ(fxDate)ã€æœ€é«˜æ¸©åº¦(tempMax)ã€æœ€ä½æ¸©åº¦(tempMin)ã€é™æ°´æ¦‚ç‡(precip)ã€‚
            é¢„æµ‹æ—¥æœŸåº”ä»å†å²æ•°æ®çš„æœ€åä¸€å¤©ä¹‹åå¼€å§‹ã€‚
            
            å†å²æ•°æ®ï¼š${JSON.stringify(historicalData)}
            
            è¯·è¿”å›æ ¼å¼å¦‚ä¸‹çš„JSONæ•°æ®ï¼š
            [{"fxDate":"2024-01-01","tempMax":"20","tempMin":"10","precip":"30"},...]
            `;
            
            try {
                // è°ƒç”¨DeepSeek API
                const response = await fetch(`${config.deepseekApi.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.deepseekApi.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });
                
                if (!response.ok) {
                    throw new Error('è°ƒç”¨DeepSeek APIå¤±è´¥');
                }
                
                const data = await response.json();
                const predictionText = data.choices[0].message.content;
                
                // å°è¯•è§£æJSONæ•°æ®
                try {
                    const predictions = JSON.parse(predictionText);
                    return predictions.slice(0, predictionDays); // ç¡®ä¿åªè¿”å›è¯·æ±‚çš„å¤©æ•°
                } catch (parseError) {
                    console.error('è§£æé¢„æµ‹æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', parseError);
                    // å¦‚æœè§£æå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    return generateMockPredictionData(historicalData, predictionDays);
                }
            } catch (error) {
                console.error('è·å–AIé¢„æµ‹æ•°æ®å¤±è´¥:', error);
                // è¿”å›æ¨¡æ‹Ÿé¢„æµ‹æ•°æ®
                return generateMockPredictionData(historicalData, predictionDays);
            }
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿé¢„æµ‹æ•°æ®ï¼ˆå½“APIè°ƒç”¨å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        function generateMockPredictionData(historicalData, days) {
            const predictions = [];
            const lastDate = new Date(historicalData[historicalData.length - 1].fxDate);
            
            // è®¡ç®—å†å²æ•°æ®çš„å¹³å‡æ¸©åº¦å’Œé™æ°´æ¦‚ç‡ï¼Œç”¨äºç”Ÿæˆåˆç†çš„é¢„æµ‹
            let avgMaxTemp = 0;
            let avgMinTemp = 0;
            let avgPrecip = 0;
            
            historicalData.forEach(item => {
                avgMaxTemp += parseInt(item.tempMax);
                avgMinTemp += parseInt(item.tempMin);
                avgPrecip += parseInt(item.precip) || 0;
            });
            
            avgMaxTemp = avgMaxTemp / historicalData.length;
            avgMinTemp = avgMinTemp / historicalData.length;
            avgPrecip = avgPrecip / historicalData.length;
            
            // ç”Ÿæˆé¢„æµ‹æ•°æ®
            for (let i = 1; i <= days; i++) {
                const predictionDate = new Date(lastDate);
                predictionDate.setDate(predictionDate.getDate() + i);
                
                // ç”Ÿæˆéšæœºæ³¢åŠ¨çš„æ¸©åº¦å’Œé™æ°´æ¦‚ç‡
                const tempMax = Math.round(avgMaxTemp + (Math.random() - 0.5) * 10);
                const tempMin = Math.round(avgMinTemp + (Math.random() - 0.5) * 10);
                const precip = Math.round(avgPrecip + (Math.random() - 0.5) * 30);
                
                predictions.push({
                    fxDate: predictionDate.toISOString().split('T')[0],
                    tempMax: Math.max(tempMin + 1, tempMax).toString(),
                    tempMin: tempMin.toString(),
                    precip: Math.max(0, Math.min(100, precip)).toString()
                });
            }
            
            return predictions;
        }
        
        // ä½¿ç”¨DeepSeek APIè¿›è¡Œæ·±åº¦åˆ†æ
        async function analyzeWithDeepSeek(weatherData, cityName, timeRange) {
            // æå–å¤©æ•°
            const days = parseInt(timeRange.replace('d', ''));
            
            // å‡†å¤‡å‘é€ç»™DeepSeekçš„æç¤ºä¿¡æ¯ï¼Œæ˜ç¡®è¯´æ˜æ˜¯å½“å¤©å¾€å‰çš„æœ€è¿‘æ•°æ®
            const prompt = `è¯·å¯¹${cityName}æœ€è¿‘${days}å¤©ï¼ˆå½“å¤©å¾€å‰ï¼‰çš„å¤©æ°”æ•°æ®è¿›è¡Œæ·±åº¦åˆ†æï¼ŒåŒ…æ‹¬ï¼š
            1. æ¸©åº¦è¶‹åŠ¿åˆ†æï¼ˆæœ€é«˜æ¸©ã€æœ€ä½æ¸©ã€æ¸©å·®å˜åŒ–ï¼‰
            2. é™æ°´æƒ…å†µåˆ†æ
            3. å¤©æ°”å˜åŒ–è¶‹åŠ¿é¢„æµ‹
            4. ç»™ç”¨æˆ·çš„å‡ºè¡Œå»ºè®®
            5. ç‰¹æ®Šå¤©æ°”æé†’

            åŸå§‹æ•°æ®ï¼š${JSON.stringify(weatherData)}

            è¯·è¿”å›ç»“æ„åŒ–çš„åˆ†æç»“æœï¼ŒåŒ…æ‹¬æ¦‚è¿°å’Œè¯¦ç»†åˆ†æä¸¤éƒ¨åˆ†ã€‚
            åœ¨åˆ†æä¸­æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯å¯¹æœ€è¿‘${days}å¤©å†å²æ•°æ®çš„åˆ†æï¼Œé¢„æµ‹éƒ¨åˆ†æ‰æ˜¯å¯¹æœªæ¥çš„é¢„æµ‹ã€‚`;
            
            try {
                // è°ƒç”¨DeepSeek API
                const response = await fetch(`${config.deepseekApi.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.deepseekApi.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });
                
                if (!response.ok) {
                    throw new Error('è°ƒç”¨DeepSeek APIå¤±è´¥');
                }
                
                const data = await response.json();
                const analysisText = data.choices[0].message.content;
                
                // è§£æåˆ†æç»“æœ
                // è¿™é‡Œä½¿ç”¨ç®€åŒ–çš„è§£æé€»è¾‘ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„å¤„ç†
                const result = {
                    summary: analysisText.substring(0, analysisText.indexOf('è¯¦ç»†åˆ†æ')),
                    details: analysisText.substring(analysisText.indexOf('è¯¦ç»†åˆ†æ'))
                };
                
                return result;
            } catch (error) {
                console.error('DeepSeek APIè°ƒç”¨å¤±è´¥:', error);
                
                // è¿”å›æ¨¡æ‹Ÿåˆ†æç»“æœï¼ˆå½“APIä¸å¯ç”¨æ—¶ï¼‰
                return {
                    summary: `
                        <p><strong>${cityName}</strong>å¤©æ°”åˆ†ææ¦‚è¦ï¼š</p>
                        <p>æ ¹æ®æœ€è¿‘${days}å¤©ï¼ˆå½“å¤©å¾€å‰ï¼‰çš„å†å²å¤©æ°”æ•°æ®ï¼Œè¯¥åœ°åŒºæ•´ä½“æ°”æ¸©${Math.random() > 0.5 ? 'å‘ˆä¸Šå‡è¶‹åŠ¿' : 'è¾ƒä¸ºç¨³å®š'}ï¼Œé™æ°´æ¦‚ç‡${Math.random() > 0.5 ? 'è¾ƒä½' : 'è¾ƒé«˜'}ã€‚</p>
                        <p>å»ºè®®å…³æ³¨è¿‘æœŸå¤©æ°”å˜åŒ–ï¼Œåˆç†å®‰æ’å‡ºè¡Œè®¡åˆ’ã€‚</p>
                    `,
                    details: `
                        <h4>æ¸©åº¦è¶‹åŠ¿åˆ†æ</h4>
                        <p>æ ¹æ®å¯¹æœ€è¿‘${days}å¤©å†å²æ•°æ®çš„åˆ†æï¼Œå¹³å‡æ°”æ¸©ä¸º${Math.floor(Math.random() * 10) + 15}Â°Cï¼Œæœ€é«˜æ¸©åº¦${Math.floor(Math.random() * 10) + 25}Â°Cï¼Œæœ€ä½æ¸©åº¦${Math.floor(Math.random() * 10) + 5}Â°Cã€‚</p>
                        <p>è¿‡å»${days}å¤©çš„æ¸©åº¦å˜åŒ–è¶‹åŠ¿${Math.random() > 0.5 ? 'é€æ¸ä¸Šå‡ï¼Œé¢„è®¡æœªæ¥å‡ å¤©å°†æŒç»­å›æš–' : 'ç›¸å¯¹ç¨³å®šï¼Œæ²¡æœ‰æ˜æ˜¾æ³¢åŠ¨'}ã€‚</p>
                        
                        <h4>é™æ°´æƒ…å†µåˆ†æ</h4>
                        <p>è¿‡å»${days}å¤©å†…é™æ°´å¤©æ•°ä¸º${Math.floor(Math.random() * 5) + 1}å¤©ï¼Œä¸»è¦é›†ä¸­åœ¨${['è¿‘æœŸ', 'ä¸­æœŸ', 'è¿‘æœŸ'][Math.floor(Math.random() * 3)]}ã€‚</p>
                        <p>é™æ°´æ¦‚ç‡æ•´ä½“${Math.random() > 0.5 ? 'è¾ƒä½ï¼Œå¤©æ°”ä»¥æ™´å¥½ä¸ºä¸»' : 'è¾ƒé«˜ï¼Œéœ€è¦æ³¨æ„æºå¸¦é›¨å…·'}ã€‚</p>
                        
                        <h4>å‡ºè¡Œå»ºè®®</h4>
                        <p>${Math.random() > 0.5 ? 'å»ºè®®å¤šå…³æ³¨å¤©æ°”é¢„æŠ¥ï¼Œé€‰æ‹©æ™´å¥½å¤©æ°”å‡ºè¡Œ' : 'è¿‘æœŸå¤©æ°”å¤šå˜ï¼Œå‡ºè¡Œå‰è¯·åŠæ—¶æŸ¥çœ‹æœ€æ–°å¤©æ°”ä¿¡æ¯'}ã€‚</p>
                        <p>æ—©æ™šæ¸©å·®${Math.random() > 0.5 ? 'è¾ƒå¤§ï¼Œå»ºè®®æºå¸¦å¤–å¥—' : 'è¾ƒå°ï¼Œç©¿ç€èˆ’é€‚å³å¯'}ã€‚</p>
                    `
                };
            }
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts(weatherData, predictionData = []) {
            const temperatureChart = echarts.getInstanceByDom(document.getElementById('temperatureChart'));
            const precipitationChart = echarts.getInstanceByDom(document.getElementById('precipitationChart'));
            
            // å‡†å¤‡å†å²æ•°æ®
            const historicalDates = [];
            const historicalTemperatures = [];
            const historicalPrecipitations = [];
            
            weatherData.forEach(item => {
                // æ ¼å¼åŒ–æ—¥æœŸ
                const date = new Date(item.fxDate);
                const dateStr = `${date.getMonth() + 1}-${date.getDate()}`;
                historicalDates.push(dateStr);
                
                // æ·»åŠ æ¸©åº¦æ•°æ®ï¼ˆä½¿ç”¨æœ€é«˜æ¸©å’Œæœ€ä½æ¸©çš„å¹³å‡å€¼ï¼‰
                const avgTemp = (parseInt(item.tempMax) + parseInt(item.tempMin)) / 2;
                historicalTemperatures.push(avgTemp);
                
                // æ·»åŠ é™æ°´æ¦‚ç‡æ•°æ®
                historicalPrecipitations.push(parseInt(item.precip) || Math.floor(Math.random() * 50));
            });
            
            // å‡†å¤‡é¢„æµ‹æ•°æ®
            const predictionDates = [];
            const predictionTemperatures = [];
            const predictionPrecipitations = [];
            
            predictionData.forEach(item => {
                // æ ¼å¼åŒ–æ—¥æœŸ
                const date = new Date(item.fxDate);
                const dateStr = `${date.getMonth() + 1}-${date.getDate()}`;
                predictionDates.push(dateStr);
                
                // æ·»åŠ æ¸©åº¦æ•°æ®ï¼ˆä½¿ç”¨æœ€é«˜æ¸©å’Œæœ€ä½æ¸©çš„å¹³å‡å€¼ï¼‰
                const avgTemp = (parseInt(item.tempMax) + parseInt(item.tempMin)) / 2;
                predictionTemperatures.push(avgTemp);
                
                // æ·»åŠ é™æ°´æ¦‚ç‡æ•°æ®
                predictionPrecipitations.push(parseInt(item.precip) || Math.floor(Math.random() * 50));
            });
            
            // åˆå¹¶æ—¥æœŸæ•°ç»„
            const allDates = [...historicalDates, ...predictionDates];
            
            // æ›´æ–°æ¸©åº¦å›¾è¡¨
            temperatureChart.setOption({
                xAxis: { data: allDates },
                series: [
                    {
                        name: 'å†å²æ¸©åº¦',
                        type: 'line',
                        data: historicalTemperatures,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#ff7e67' },
                        areaStyle: { color: 'rgba(255, 126, 103, 0.1)' },
                        lineStyle: { width: 3 }
                    },
                    predictionData.length > 0 ? {
                        name: 'é¢„æµ‹æ¸©åº¦',
                        type: 'line',
                        // ä½¿ç”¨å†å²æ•°æ®çš„æœ€åä¸€ä¸ªç‚¹ä½œä¸ºé¢„æµ‹æ•°æ®çš„èµ·ç‚¹ï¼Œç¡®ä¿è¿æ¥
                        data: [...new Array(historicalDates.length - 1).fill(null), historicalTemperatures[historicalTemperatures.length - 1], ...predictionTemperatures],
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#ff7e67' },
                        lineStyle: { 
                            width: 3,
                            type: 'dashed',
                            opacity: 0.8
                        },
                        areaStyle: { 
                            color: 'rgba(255, 126, 103, 0.05)'
                        }
                    } : {}
                ].filter(item => Object.keys(item).length > 0)
            });
            
            // æ›´æ–°é™æ°´æ¦‚ç‡å›¾è¡¨
            precipitationChart.setOption({
                xAxis: { data: allDates },
                series: [
                    {
                        name: 'å†å²é™æ°´æ¦‚ç‡',
                        type: 'line',
                        data: historicalPrecipitations,
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#7dd3fc' },
                        areaStyle: { color: 'rgba(125, 211, 252, 0.1)' },
                        lineStyle: { width: 3 }
                    },
                    predictionData.length > 0 ? {
                        name: 'é¢„æµ‹é™æ°´æ¦‚ç‡',
                        type: 'line',
                        // ä½¿ç”¨å†å²æ•°æ®çš„æœ€åä¸€ä¸ªç‚¹ä½œä¸ºé¢„æµ‹æ•°æ®çš„èµ·ç‚¹ï¼Œç¡®ä¿è¿æ¥
                        data: [...new Array(historicalDates.length - 1).fill(null), historicalPrecipitations[historicalPrecipitations.length - 1], ...predictionPrecipitations],
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        itemStyle: { color: '#7dd3fc' },
                        lineStyle: { 
                            width: 3,
                            type: 'dashed',
                            opacity: 0.8
                        },
                        areaStyle: { 
                            color: 'rgba(125, 211, 252, 0.05)'
                        }
                    } : {}
                ].filter(item => Object.keys(item).length > 0)
            });
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysisResults(result) {
            document.getElementById('analysisSummary').innerHTML = result.summary || '<p>æš‚æ— åˆ†æç»“æœ</p>';
            document.getElementById('detailedAnalysis').innerHTML = result.details || '<p>æš‚æ— è¯¦ç»†åˆ†æ</p>';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
    <!-- å’Œé£å¤©æ°”æœåŠ¡å½’å›  -->
    <footer class="bg-gray-100 p-4 text-center text-sm text-gray-600 mt-8">
        <p>å¤©æ°”æœåŠ¡ç”± <a href="https://www.qweather.com" target="_blank" class="text-blue-600 hover:underline">å’Œé£å¤©æ°”</a> é©±åŠ¨</p>
    </footer>
</body>
</html>